<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Helper functions &mdash; amrex-hydro 22.01-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="References" href="references.html" />
    <link rel="prev" title="Redistribution" href="Redistribution.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> amrex-hydro
          </a>
              <div class="version">
                22.01-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Schemes.html">Advection Schemes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Projections.html">Projection Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="Redistribution.html">Redistribution</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Helper functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#notation">Notation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#slopes">Slopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#eb-slopes">EB Slopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#boundary-conditions">Boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#computing-fluxes">Computing Fluxes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#intensive">Intensive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extensive">Extensive</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#constructing-the-advective-term">Constructing the advective term</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#intensive-fluxes">Intensive fluxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extensive-fluxes">Extensive fluxes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex-hydro</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Helper functions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Utilities.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="math notranslate nohighlight">
\[\newcommand{\half}{\frac{1}{2}}
\newcommand{\nph}{{n + \half}}
\newcommand{\nmh}{{n - \frac{1}{2}}}
\newcommand{\iphj}{{i+\frac{1}{2},j,k}}
\newcommand{\ijph}{{i,j+\frac{1}{2}},k}
\newcommand{\imhj}{{i-\frac{1}{2},j,k}}
\newcommand{\ijmh}{{i,j-\frac{1}{2}},k}
\newcommand{\ijkmh}{{i,j,k-\frac{1}{2}}}
\newcommand{\ijkph}{{i,j,k+\frac{1}{2}}}
\newcommand{\grad}{\nabla}
\newcommand{\del}{\nabla}
\newcommand{\AN}{[(U \cdot \nabla)U]^{n+\frac{1}{2}}}
\newcommand{\npk}{{n + \frac{p+\half}{R}}}
\newcommand{\nak}{{n + \frac{p}{R}}}
\newcommand{\nmk}{{n + \frac{p-\half}{R}}}
\newcommand{\iph}{i+\half}
\newcommand{\imh}{i-\half}
\newcommand{\ipmh}{i\pm\half}
\newcommand{\jph}{j+\half}
\newcommand{\jmh}{j-\half}
\newcommand{\jpmh}{j\pm\half}
\newcommand{\kph}{k+\half}
\newcommand{\kmh}{k-\half}
\newcommand{\GMAC}{C \rightarrow E}
\newcommand{\DMAC}{E \rightarrow C}
\newcommand{\U}{\boldsymbol{U}}
\newcommand{\F}{\boldsymbol{F}}
\newcommand{\dt}{\Delta t}
\newcommand{\shalf}{\sfrac{1}{2}}
\newcommand\hathat[1]{\widehat{\widehat{#1}}}
\newcommand\hairbow[1]{\overset{\bowtie}{#1}}
\newcommand\widebreve[1]{\overset{\smile}{#1}}
\newcommand{\vol}{\mathcal{V}}
\newcommand{\area}{\mathcal{A}}\]</div>
<section id="helper-functions">
<span id="utilities"></span><h1>Helper functions<a class="headerlink" href="#helper-functions" title="Permalink to this heading"></a></h1>
<section id="notation">
<h2>Notation<a class="headerlink" href="#notation" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(dx\)</span>, <span class="math notranslate nohighlight">\(dy\)</span>, <span class="math notranslate nohighlight">\(dz\)</span> : cell sizes in the x-, y- and z- directions, respectively.</p></li>
<li><p><span class="math notranslate nohighlight">\(\vol_{i,j,k}\)</span> : Volume of cell-centered element <span class="math notranslate nohighlight">\((i,j,k)\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\area\)</span> : Area of a cell face. For example,
<span class="math notranslate nohighlight">\(\area_{i-\half ,j,k}\)</span> represents the area of the lower x-face of the <span class="math notranslate nohighlight">\((i,j,k)\)</span>-th cell,</p></li>
</ul>
<p>For problems with embedded boundaries, we also define</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\kappa_{i,j,k}\)</span> : Volume fraction of cell <span class="math notranslate nohighlight">\((i,j,k)\)</span>. Data are in the range
of <span class="math notranslate nohighlight">\([0,1]\)</span> with zero representing covered cells and one for regular
cells, so that for regular cells <span class="math notranslate nohighlight">\(\kappa_{i,j,k} \vol_{i,j,k} =  dx\ dy\ dz\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span> : Area fractions. For example,
<span class="math notranslate nohighlight">\(\alpha_{i-\half ,j,k}\)</span> corresponds to the the lower x-face of the <span class="math notranslate nohighlight">\((i,j,k)\)</span>-th cell.
Data are in the range of <span class="math notranslate nohighlight">\([0,1]\)</span> with zero representing a covered face
and one an un-cut face, so that for regular cells
<span class="math notranslate nohighlight">\(\alpha_{i-\half ,j,k} \area_{i-\half ,j,k} = dy\ dz\)</span>.</p></li>
</ul>
<p>Note that EB is only an option for Cartesian geometries as of this writing.</p>
</section>
<section id="slopes">
<span id="id1"></span><h2>Slopes<a class="headerlink" href="#slopes" title="Permalink to this heading"></a></h2>
<p>AMReX-Hydro includes implementations of several different slope routines along with options to apply limiters.
For cells where this calculation would involve all regular cells (i.e. no cut or covered cells),
there are second-order and fourth-order stencils.</p>
<p>For (EB)Godunov, the default is monotonicity-limited fourth-order slopes.
For (EB)MOL, the default is monotonicity-limited second-order slopes.
Default limiting is as described in Colella (1985) <span id="id2">[<a class="reference internal" href="references.html#id15" title="P. Colella and H. M. Glaz. Efficient solution algorithms for the Riemann problem for real gases. Journal of Computational Physics, 59:264-289, June 1985. doi:10.1016/0021-9991(85)90146-9.">Colella and Glaz, 1985</a>]</span>,
where limiting is done on each component of the velocity individually.</p>
</section>
<section id="eb-slopes">
<span id="ebslopes"></span><h2>EB Slopes<a class="headerlink" href="#eb-slopes" title="Permalink to this heading"></a></h2>
<p>The procedure for problems with embedded boundaries
is detailed below, and attempts to use standard (non-EB) stencils wherever possible.</p>
<ul class="simple">
<li><p>First, AMReX-Hydro attempts to compute the slope of the desired order (4 for Godunov and 2 for MOL)
using standard stencils and limiters.</p></li>
<li><p>For cases where a fourth-order slope is desired but the stencil would require the use of cut cells
(as happens in EBGodunov), the code next attempts to use the standard second-order slope and limiter.</p></li>
<li><p>If the standard second-order slope calculation
would require the use of cut cells, then the slope computation will use a least squares approach,
involving a linear fit to the at-most 26 (or 8 in 2D) nearest neighbors, with the function
going through the centroid of cell (i,j,k) to the face centroid. This does not assume that the
cell centroids, where the data is assumed to live, are the same as cell centers.
This least-squares slope is then multiplied by a limiter based on the work of Barth-Jespersen
that enforces no new maxima or minima when the state is predicted to the face centroids.</p></li>
</ul>
</section>
<section id="boundary-conditions">
<span id="bcs"></span><h2>Boundary conditions<a class="headerlink" href="#boundary-conditions" title="Permalink to this heading"></a></h2>
<p>AMReX-Hydro uses underlying AMReX functionality in implementing boundary conditions
(see AMReX’s documentation section <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/Basics.html#sec-basics-boundary" title="(in amrex v22.01-dev)"><span>Boundary Conditions</span></a>).
Physical boundary conditions, such as
inflow, outflow, slip/no-slip walls, etc., and are ultimately linked to
mathematical Dirichlet or Neumann conditions.
See <code class="docutils literal notranslate"><span class="pre">amrex/Src/Base/AMReX_BC_TYPES.H</span></code> for common physical and mathematical types.</p>
<p>Domain boundary conditions affect the pre-MAC extrapolated velocities in three ways.</p>
<ol class="arabic simple">
<li><p>Potential impact to the slope computation in cells
adjacent to the domain boundary (see <a class="reference internal" href="#slopes"><span class="std std-ref">Slopes</span></a> section).</p></li>
<li><p>Direct enforcement of the boundary condition: If the face is on a domain boundary and the boundary
condition type is</p>
<ul class="simple">
<li><p>External Dirichlet (<code class="docutils literal notranslate"><span class="pre">extdir</span></code>): we set <span class="math notranslate nohighlight">\(u_L\)</span> to the boundary value, and then
for the normal component of the velocity only, we set <span class="math notranslate nohighlight">\(u_R = u_L\)</span>
This is done because for turbulent inflow, there can be times when the inflow face
actually has outflowing velocity. In this case, we want to use the normal component as
specified by the BC, but then allow that outflowing velocity to transport values that come
from the interior.</p></li>
<li><p>First-order extrapolation (<code class="docutils literal notranslate"><span class="pre">foextrap</span></code>), higher order extrapolation (<code class="docutils literal notranslate"><span class="pre">hoextrap</span></code>), or
even reflection about the boundary (<code class="docutils literal notranslate"><span class="pre">reflecteven</span></code>):</p>
<ul>
<li><p>on the low side of the domain, we set <span class="math notranslate nohighlight">\(u_L = u_R.\)</span></p></li>
<li><p>on the high side, we set <span class="math notranslate nohighlight">\(u_R = u_L.\)</span></p></li>
</ul>
</li>
<li><p>Odd reflection about the boundary (<code class="docutils literal notranslate"><span class="pre">reflectodd</span></code>) , we set <span class="math notranslate nohighlight">\(u_L = u_R = 0.\)</span></p></li>
</ul>
</li>
<li><p>To prohibit back flow into the domain at an outflow face (<code class="docutils literal notranslate"><span class="pre">foextrap</span></code> or <code class="docutils literal notranslate"><span class="pre">hoextrap</span></code> mathematical BCs):</p>
<ul class="simple">
<li><p>on the low side, we set <span class="math notranslate nohighlight">\(u_L = u_R = \min (u_R, 0).\)</span></p></li>
<li><p>on the high side, we set <span class="math notranslate nohighlight">\(u_L = u_R = \max (u_L, 0).\)</span></p></li>
</ul>
</li>
</ol>
<p>For the post-MAC edge state,</p>
<ol class="arabic simple">
<li><p>Same as pre-MAC</p></li>
<li><p>Same as pre-MAC</p></li>
<li><p>Here, we do not impose the <span class="target" id="no-inflow-at-outflow">no-inflow-at-outflow</span> condition quite as described above;
instead we enforce that if <span class="math notranslate nohighlight">\(u^{MAC}\)</span> on an outflow face is inflowing,
the normal velocity component must be outflowing or zero. We do this by imposing</p>
<ul class="simple">
<li><p>on the low side, if <span class="math notranslate nohighlight">\(u^{MAC}\ge 0\)</span> (i.e the flow is
coming in at an outflow face) and <span class="math notranslate nohighlight">\(s\)</span> is the x-velocity, then
<span class="math notranslate nohighlight">\(s_L = s_R = \min(s_R,0).\)</span></p></li>
<li><p>on the high side, if <span class="math notranslate nohighlight">\(u^{MAC}&lt;= 0\)</span> on the domain face, then
<span class="math notranslate nohighlight">\(s_L = s_R = \max(s_L,0).\)</span></p></li>
</ul>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Boundary conditions are imposed before the upwinding described in the <a class="reference internal" href="Schemes.html#schemes"><span class="std std-ref">Advection schemes</span></a> section.</p>
</div>
<p>API documentation can be found in the Doxygen Technical Reference,
functions <a class="reference external" href="https://amrex-codes.github.io/amrex-hydro/Doxygen/html/namespaceHydroBC.html#ab90f8ce229a7ebbc521dc27d65f2db9a">SetXEdgeBCs</a>, <a class="reference external" href="https://amrex-codes.github.io/amrex-hydro/Doxygen/html/namespaceHydroBC.html#a6865c2cfd50cc95f9b69ded1e8ac78ab">SetYEdgeBCs</a>, <a class="reference external" href="https://amrex-codes.github.io/amrex-hydro/Doxygen/html/namespaceHydroBC.html#a19ddc5ac50e9a6b9a98bc17f3815a62e">SetZEdgeBCs</a> .</p>
<div class="math notranslate nohighlight">
\[\newcommand{\half}{\frac{1}{2}}
\newcommand{\nph}{{n + \half}}
\newcommand{\nmh}{{n - \frac{1}{2}}}
\newcommand{\iphj}{{i+\frac{1}{2},j,k}}
\newcommand{\ijph}{{i,j+\frac{1}{2}},k}
\newcommand{\imhj}{{i-\frac{1}{2},j,k}}
\newcommand{\ijmh}{{i,j-\frac{1}{2}},k}
\newcommand{\ijkmh}{{i,j,k-\frac{1}{2}}}
\newcommand{\ijkph}{{i,j,k+\frac{1}{2}}}
\newcommand{\grad}{\nabla}
\newcommand{\del}{\nabla}
\newcommand{\AN}{[(U \cdot \nabla)U]^{n+\frac{1}{2}}}
\newcommand{\npk}{{n + \frac{p+\half}{R}}}
\newcommand{\nak}{{n + \frac{p}{R}}}
\newcommand{\nmk}{{n + \frac{p-\half}{R}}}
\newcommand{\iph}{i+\half}
\newcommand{\imh}{i-\half}
\newcommand{\ipmh}{i\pm\half}
\newcommand{\jph}{j+\half}
\newcommand{\jmh}{j-\half}
\newcommand{\jpmh}{j\pm\half}
\newcommand{\kph}{k+\half}
\newcommand{\kmh}{k-\half}
\newcommand{\GMAC}{C \rightarrow E}
\newcommand{\DMAC}{E \rightarrow C}
\newcommand{\U}{\boldsymbol{U}}
\newcommand{\F}{\boldsymbol{F}}
\newcommand{\dt}{\Delta t}
\newcommand{\shalf}{\sfrac{1}{2}}
\newcommand\hathat[1]{\widehat{\widehat{#1}}}
\newcommand\hairbow[1]{\overset{\bowtie}{#1}}
\newcommand\widebreve[1]{\overset{\smile}{#1}}
\newcommand{\vol}{\mathcal{V}}
\newcommand{\area}{\mathcal{A}}\]</div>
</section>
<section id="computing-fluxes">
<span id="fluxes"></span><h2>Computing Fluxes<a class="headerlink" href="#computing-fluxes" title="Permalink to this heading"></a></h2>
<p>Doxygen links
<a class="reference external" href="https://amrex-codes.github.io/amrex-hydro/Doxygen/html/namespaceHydroUtils.html#ab70f040557a658e70ba076c9d105bab7">ComputeFluxes</a>
and
<a class="reference external" href="https://amrex-codes.github.io/amrex-hydro/Doxygen/html/namespaceHydroUtils.html#ab70f040557a658e70ba076c9d105bab7">EB_ComputeFluxes</a> .</p>
<p>AMReX-Hydro has the option to compute intesive or extensive, i.e. area-weighted, fluxes.
Extensive fluxes are always used for problems using R-Z geometry,
and AMReX has functions for computing the position dependent cell volume and face areas
(see <a class="reference external" href="https://amrex-codes.github.io/amrex/doxygen/classamrex_1_1Geometry.html#a8e4aa2c2e88a46cb31b1ce0f9590c350">Geometry::GetFaceArea</a> and
<a class="reference external" href="https://amrex-codes.github.io/amrex/doxygen/classamrex_1_1Geometry.html#af7996fe47b1e82704565102c15df47c9">Geometry::GetVolume</a>).
We first give the formulas for the EB-regular case,
and then those used when embedded boundaries are present.</p>
<section id="intensive">
<h3>Intensive<a class="headerlink" href="#intensive" title="Permalink to this heading"></a></h3>
<p>Intensive fluxes are computed from the advective velocity, <span class="math notranslate nohighlight">\(\U^{MAC}\)</span>, and edge states, <span class="math notranslate nohighlight">\(s\)</span>,
by defining</p>
<div class="math notranslate nohighlight" id="equation-flux-eq1">
<span class="eqno">(18)<a class="headerlink" href="#equation-flux-eq1" title="Permalink to this equation"></a></span>\[F_{i-\frac{1}{2},j,k}^{x,n+\frac{1}{2}} = u^{MAC}_{i-\frac{1}{2},j,k}\; s_{i-\frac{1}{2},j,k}^{n+\frac{1}{2}}\]</div>
<p>on all x-faces,</p>
<div class="math notranslate nohighlight" id="equation-flux-eq2">
<span class="eqno">(19)<a class="headerlink" href="#equation-flux-eq2" title="Permalink to this equation"></a></span>\[F_{i,j-\frac{1}{2},k}^{y,n+\frac{1}{2}} = v^{MAC}_{i,j-\frac{1}{2},k}\; s_{i,j-\frac{1}{2},k}^{n+\frac{1}{2}}\]</div>
<p>on all y-faces, and</p>
<div class="math notranslate nohighlight" id="equation-flux-eq3">
<span class="eqno">(20)<a class="headerlink" href="#equation-flux-eq3" title="Permalink to this equation"></a></span>\[F_{i,j,k-\frac{1}{2}}^{z,n+\frac{1}{2}} = w^{MAC}_{i,j,k-\frac{1}{2}}\; s_{i,j,k-\frac{1}{2}}^{n+\frac{1}{2}}\]</div>
<p>on all z-faces.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>When embedded boundaries are present, intensive fluxes are computed as</p>
<div class="math notranslate nohighlight">
\[F_{i-\frac{1}{2},j,k}^{x,n+\frac{1}{2}} = \alpha_{i-\frac{1}{2},j,k} \; u^{MAC}_{i-\frac{1}{2},j,k} \; s_{i-\frac{1}{2},j,k}^{n+\frac{1}{2}}\]</div>
<p>on all x-faces,</p>
<div class="math notranslate nohighlight">
\[F_{i,j-\frac{1}{2},k}^{y,n+\frac{1}{2}} = \alpha_{i,j-\frac{1}{2},k} \; v^{MAC}_{i,j-\frac{1}{2},k} \; s_{i,j-\frac{1}{2},k}^{n+\frac{1}{2}}\]</div>
<p>on all y-faces,</p>
<div class="math notranslate nohighlight">
\[F_{i,j,k-\frac{1}{2}}^{z,n+\frac{1}{2}} = \alpha_{i,j,k-\frac{1}{2}} \; w^{MAC}_{i,j,k-\frac{1}{2}}\; s_{i,j,k-\frac{1}{2}}^{n+\frac{1}{2}}\]</div>
<p>on all z-faces.
Here <span class="math notranslate nohighlight">\(\alpha_{i-\frac{1}{2},j,k}\)</span> is the area fraction of the lower x-face of cell-centered element <span class="math notranslate nohighlight">\((i,j,k)\)</span>, etc.</p>
</section>
<section id="extensive">
<h3>Extensive<a class="headerlink" href="#extensive" title="Permalink to this heading"></a></h3>
<p>Extensive fluxes are computed as</p>
<div class="math notranslate nohighlight">
\[F_{i-\frac{1}{2},j,k}^{x,n+\frac{1}{2}} = \area_{i-\frac{1}{2},j,k} \; u^{MAC}_{i-\frac{1}{2},j,k} \; s_{i-\frac{1}{2},j,k}^{n+\frac{1}{2}}\]</div>
<p>on all x-faces,</p>
<div class="math notranslate nohighlight">
\[F_{i,j-\frac{1}{2},k}^{y,n+\frac{1}{2}} = \area_{i,j-\frac{1}{2},k} \; v^{MAC}_{i,j-\frac{1}{2},k} \; s_{i,j-\frac{1}{2},k}^{n+\frac{1}{2}}\]</div>
<p>on all y-faces,</p>
<div class="math notranslate nohighlight">
\[F_{i,j,k-\frac{1}{2}}^{z,n+\frac{1}{2}} = \area_{i,j,k-\frac{1}{2}} \; w^{MAC}_{i,j,k-\frac{1}{2}}\; s_{i,j,k-\frac{1}{2}}^{n+\frac{1}{2}}\]</div>
<p>on all z-faces.</p>
<p>where <span class="math notranslate nohighlight">\(\area_{i-\frac{1}{2},j,k}\)</span> is the area of the lower x-face of cell-centered element <span class="math notranslate nohighlight">\((i,j,k)\)</span>, etc.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>For EB, we simply scale area the by the area fraction in the above equations. For example, we use
<span class="math notranslate nohighlight">\(\alpha_{i-\frac{1}{2},j,k} \area_{i-\frac{1}{2},j,k}\)</span> in place of <span class="math notranslate nohighlight">\(\area_{i-\frac{1}{2},j,k}\)</span>, etc.</p>
<div class="math notranslate nohighlight">
\[\newcommand{\half}{\frac{1}{2}}
\newcommand{\nph}{{n + \half}}
\newcommand{\nmh}{{n - \frac{1}{2}}}
\newcommand{\iphj}{{i+\frac{1}{2},j,k}}
\newcommand{\ijph}{{i,j+\frac{1}{2}},k}
\newcommand{\imhj}{{i-\frac{1}{2},j,k}}
\newcommand{\ijmh}{{i,j-\frac{1}{2}},k}
\newcommand{\ijkmh}{{i,j,k-\frac{1}{2}}}
\newcommand{\ijkph}{{i,j,k+\frac{1}{2}}}
\newcommand{\grad}{\nabla}
\newcommand{\del}{\nabla}
\newcommand{\AN}{[(U \cdot \nabla)U]^{n+\frac{1}{2}}}
\newcommand{\npk}{{n + \frac{p+\half}{R}}}
\newcommand{\nak}{{n + \frac{p}{R}}}
\newcommand{\nmk}{{n + \frac{p-\half}{R}}}
\newcommand{\iph}{i+\half}
\newcommand{\imh}{i-\half}
\newcommand{\ipmh}{i\pm\half}
\newcommand{\jph}{j+\half}
\newcommand{\jmh}{j-\half}
\newcommand{\jpmh}{j\pm\half}
\newcommand{\kph}{k+\half}
\newcommand{\kmh}{k-\half}
\newcommand{\GMAC}{C \rightarrow E}
\newcommand{\DMAC}{E \rightarrow C}
\newcommand{\U}{\boldsymbol{U}}
\newcommand{\F}{\boldsymbol{F}}
\newcommand{\dt}{\Delta t}
\newcommand{\shalf}{\sfrac{1}{2}}
\newcommand\hathat[1]{\widehat{\widehat{#1}}}
\newcommand\hairbow[1]{\overset{\bowtie}{#1}}
\newcommand\widebreve[1]{\overset{\smile}{#1}}
\newcommand{\vol}{\mathcal{V}}
\newcommand{\area}{\mathcal{A}}\]</div>
</section>
</section>
<section id="constructing-the-advective-term">
<span id="advective-term"></span><h2>Constructing the advective term<a class="headerlink" href="#constructing-the-advective-term" title="Permalink to this heading"></a></h2>
<p>AMReX-Hydro provides the option to compute the advective term either in
conservative (<span class="math notranslate nohighlight">\(\grad \cdot \U s\)</span>) or convective form (<span class="math notranslate nohighlight">\(\U \cdot \grad s\)</span>).
The exact equations differ slightly depending on whether the fluxes are
intensive or extensive (required for R-Z coordinates).</p>
<section id="intensive-fluxes">
<h3>Intensive fluxes<a class="headerlink" href="#intensive-fluxes" title="Permalink to this heading"></a></h3>
<p>If the variable, <span class="math notranslate nohighlight">\(s\)</span> is to be updated conservatively, we construct</p>
<div class="math notranslate nohighlight">
\[\begin{split}\nabla \cdot \left({\bf u} s\right)^{n+\frac{1}{2}}
                          = &amp; \frac{1}{dx} \left(F_{i+\frac{1}{2},j,k}^{x,n+\frac{1}{2}} -
                               F_{i-\frac{1}{2},j,k}^{x,n+\frac{1}{2}}\right) + \\
                            &amp; \frac{1}{dy} \left(F_{i,j+\frac{1}{2},k}^{y,n+\frac{1}{2}} -
                               F_{i,j-\frac{1}{2},k}^{y,n+\frac{1}{2}}\right) + \\
                            &amp; \frac{1}{dz} \left(F_{i,j,k+\frac{1}{2}}^{z,n+\frac{1}{2}} -
                               F_{i,j,k-\frac{1}{2}}^{z,n+\frac{1}{2}}\right)\end{split}\]</div>
<p>while if <span class="math notranslate nohighlight">\(s\)</span> is to be updated in convective form, we construct</p>
<div class="math notranslate nohighlight">
\[\left({\bf u}\cdot \nabla s\right)^{n+\frac{1}{2}} = \nabla \cdot \left({\bf u} s\right)^{n+\frac{1}{2}} - s_{i,j,k}^{n+\frac{1}{2}} \; \left(DU\right)^{MAC}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left(DU\right)^{MAC} = \;
                &amp; \frac{1}{dx} \left(u^{MAC}_{i+\frac{1}{2},j,k} - u^{MAC}_{i-\frac{1}{2},j,k}\right) + \\
                &amp; \frac{1}{dy} \left(v^{MAC}_{i,j-\frac{1}{2},k} - v^{MAC}_{i,j-\frac{1}{2},k}\right) + \\
                &amp; \frac{1}{dz} \left(w^{MAC}_{i,j,k-\frac{1}{2}} - w^{MAC}_{i,j,k-\frac{1}{2}}\right)\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[s_{i,j,k}^{{n+\frac{1}{2}}} = \frac{1}{6} \left(
                 s_{i-\frac{1}{2},j,k}^{{n+\frac{1}{2}}} + s_{i+\frac{1}{2},j,k}^{{n+\frac{1}{2}}}
             +   s_{i,j-\frac{1}{2},k}^{{n+\frac{1}{2}}} + s_{i,j-\frac{1}{2},k}^{{n+\frac{1}{2}}}
             +   s_{i,j,k-\frac{1}{2}}^{{n+\frac{1}{2}}} + s_{i,j,k-\frac{1}{2}}^{{n+\frac{1}{2}}} \right)\]</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</section>
<section id="extensive-fluxes">
<h3>Extensive fluxes<a class="headerlink" href="#extensive-fluxes" title="Permalink to this heading"></a></h3>
<p>Given extensive fluxes we must divide by the cell volume in constructing the advective term.
Here, we give the form for EB and note that the EB-regular case is obtained by setting both <span class="math notranslate nohighlight">\(\alpha = 1\)</span> and
<span class="math notranslate nohighlight">\(\kappa=1\)</span>.
If the variable, <span class="math notranslate nohighlight">\(s\)</span> is to be updated conservatively, on all cells with <span class="math notranslate nohighlight">\(\kappa_{i,j,k} &gt; 0\)</span> we construct</p>
<div class="math notranslate nohighlight">
\[\begin{split}\nabla \cdot ({\bf u}s)^{n+\frac{1}{2}} = \frac{1}{ \kappa_{i,j,k} \vol_{i,j,k}}[
                       &amp; ( F_{i+\frac{1}{2},j,k}^{{x,n+\frac{1}{2}}} -F_{i-\frac{1}{2},j,k}^{{x,n+\frac{1}{2}}}) + \\
                       &amp; ( F_{i,j+\frac{1}{2},k}^{{y,n+\frac{1}{2}}} -F_{i,j-\frac{1}{2},k}^{{y,n+\frac{1}{2}}}) + \\
                       &amp; ( F_{i,j,k+\frac{1}{2}}^{{z,n+\frac{1}{2}}} -F_{i,j,k-\frac{1}{2}}^{{z,n+\frac{1}{2}}}) ]\end{split}\]</div>
<p>while if <span class="math notranslate nohighlight">\(s\)</span> is to be updated in convective form, we construct</p>
<div class="math notranslate nohighlight">
\[({\bf u}\cdot \nabla s)^{n+\frac{1}{2}} = \nabla \cdot ({\bf u}s)^{n+\frac{1}{2}} - s_{i,j,k}^{{n+\frac{1}{2}}} (DU)^{MAC}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}(DU)^{MAC}  = \frac{1}{\kappa_{i,j,k} \vol_{i,j,k}} [ &amp; (\alpha_{i+\frac{1}{2},j,k} \area_{i+\frac{1}{2},j,k} u^{MAC}_{i+\frac{1}{2},j,k}-
\alpha_{i-\frac{1}{2},j,k} \area_{i-\frac{1}{2},j,k} u^{MAC}_{i-\frac{1}{2},j,k}) + \\
                &amp; (\alpha_{i,j+\frac{1}{2},k} \area_{i,j+\frac{1}{2},k} v^{MAC}_{i,j-\frac{1}{2},k}-
        \alpha_{i,j-\frac{1}{2},k} \area_{i,j-\frac{1}{2},k} v^{MAC}_{i,j-\frac{1}{2},k}) + \\
                &amp; (\alpha_{i,j,k+\frac{1}{2}} \area_{i,j,k+\frac{1}{2}} w^{MAC}_{i,j,k-\frac{1}{2}}-
        \alpha_{i,j,k-\frac{1}{2}} \area_{i,j,k-\frac{1}{2}} w^{MAC}_{i,j,k-\frac{1}{2}}) ]\end{split}\]</div>
<div class="math notranslate nohighlight">
\[s_{i,j,k}^{{n+\frac{1}{2}}} = (1/6) (
                 s_{i-\frac{1}{2},j,k}^{{n+\frac{1}{2}}} + s_{i+\frac{1}{2},j,k}^{{n+\frac{1}{2}}}
             +   s_{i,j-\frac{1}{2},k}^{{n+\frac{1}{2}}} + s_{i,j-\frac{1}{2},k}^{{n+\frac{1}{2}}}
             +   s_{i,j,k-\frac{1}{2}}^{{n+\frac{1}{2}}} + s_{i,j,k-\frac{1}{2}}^{{n+\frac{1}{2}}} )\]</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Redistribution.html" class="btn btn-neutral float-left" title="Redistribution" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="references.html" class="btn btn-neutral float-right" title="References" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2018, AMReX-Hydro Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>