

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>EBGodunov &mdash; amrex-hydro 21.09-dev documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="EBMOL" href="EBMOL.html" />
    <link rel="prev" title="AMReX-Hydro" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> amrex-hydro
          

          
          </a>

          
            
            
              <div class="version">
                21.09-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">EBGodunov</a></li>
<li class="toctree-l1"><a class="reference internal" href="EBMOL.html">EBMOL</a></li>
<li class="toctree-l1"><a class="reference internal" href="Godunov.html">Godunov</a></li>
<li class="toctree-l1"><a class="reference internal" href="MOL.html">MOL</a></li>
<li class="toctree-l1"><a class="reference internal" href="Redistribution.html">Redistribution</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex-hydro</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>EBGodunov</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/EBGodunov.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="ebgodunov">
<h1>EBGodunov<a class="headerlink" href="#ebgodunov" title="Permalink to this headline">¶</a></h1>
<p>To create the normal velocities on faces, we first extrapolate from the cell centers on each side using the
slopes as computed earlier, and upwind the face value to define  <span class="math notranslate nohighlight">\(U^{pred}\)</span>.
To compute the x-velocity on the x-faces of regular (ie not cut) cells, we call</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>AMREX_CUDA_HOST_DEVICE_FOR_3D<span class="o">(</span>ubx, i, j, k,
 <span class="o">{</span>
     // X-faces
     Real <span class="nv">upls</span>     <span class="o">=</span> ccvel_fab<span class="o">(</span>i  ,j,k,0<span class="o">)</span> - <span class="m">0</span>.5 * xslopes_fab<span class="o">(</span>i  ,j,k,0<span class="o">)</span><span class="p">;</span>
     Real <span class="nv">umns</span>     <span class="o">=</span> ccvel_fab<span class="o">(</span>i-1,j,k,0<span class="o">)</span> + <span class="m">0</span>.5 * xslopes_fab<span class="o">(</span>i-1,j,k,0<span class="o">)</span><span class="p">;</span>
     <span class="k">if</span> <span class="o">(</span> umns &lt; <span class="m">0</span>.0 <span class="o">&amp;&amp;</span> upls &gt; <span class="m">0</span>.0 <span class="o">)</span> <span class="o">{</span>
        umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.0<span class="p">;</span>
     <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        Real <span class="nv">avg</span> <span class="o">=</span> <span class="m">0</span>.5 * <span class="o">(</span> upls + umns <span class="o">)</span><span class="p">;</span>
        <span class="k">if</span> <span class="o">(</span> std::abs<span class="o">(</span>avg<span class="o">)</span> &lt;  small_vel<span class="o">)</span> <span class="o">{</span> umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.0<span class="p">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span>avg &gt;<span class="o">=</span> <span class="m">0</span><span class="o">)</span>             <span class="o">{</span> umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> umns<span class="p">;</span>
        <span class="o">}</span> <span class="k">else</span>                           <span class="o">{</span> umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> upls<span class="p">;</span>
        <span class="o">}</span>
     <span class="o">}</span>
 <span class="o">})</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>For cut cells we test on whether the area fraction is non-zero:</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>AMREX_CUDA_HOST_DEVICE_FOR_3D<span class="o">(</span>ubx, i, j, k,
<span class="o">{</span>
    // X-faces
    <span class="k">if</span> <span class="o">(</span>ax_fab<span class="o">(</span>i,j,k<span class="o">)</span> &gt; <span class="m">0</span>.0<span class="o">)</span>
    <span class="o">{</span>
       Real <span class="nv">upls</span>     <span class="o">=</span> ccvel_fab<span class="o">(</span>i  ,j,k,0<span class="o">)</span> - <span class="m">0</span>.5 * xslopes_fab<span class="o">(</span>i  ,j,k,0<span class="o">)</span><span class="p">;</span>
       Real <span class="nv">umns</span>     <span class="o">=</span> ccvel_fab<span class="o">(</span>i-1,j,k,0<span class="o">)</span> + <span class="m">0</span>.5 * xslopes_fab<span class="o">(</span>i-1,j,k,0<span class="o">)</span><span class="p">;</span>
       <span class="k">if</span> <span class="o">(</span> umns &lt; <span class="m">0</span>.0 <span class="o">&amp;&amp;</span> upls &gt; <span class="m">0</span>.0 <span class="o">)</span> <span class="o">{</span>
          umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.0<span class="p">;</span>
       <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          Real <span class="nv">avg</span> <span class="o">=</span> <span class="m">0</span>.5 * <span class="o">(</span> upls + umns <span class="o">)</span><span class="p">;</span>
          <span class="k">if</span> <span class="o">(</span> std::abs<span class="o">(</span>avg<span class="o">)</span> &lt;  small_vel<span class="o">)</span> <span class="o">{</span> umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> <span class="m">0</span>.0<span class="p">;</span>
          <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span>avg &gt;<span class="o">=</span> <span class="m">0</span><span class="o">)</span>             <span class="o">{</span> umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> umns<span class="p">;</span>
          <span class="o">}</span> <span class="k">else</span>                           <span class="o">{</span> umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> upls<span class="p">;</span>
          <span class="o">}</span>
       <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          umac_fab<span class="o">(</span>i,j,k<span class="o">)</span> <span class="o">=</span> huge_vel<span class="p">;</span>
    <span class="o">}</span>
<span class="o">})</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<p>We then perform a MAC projection on the face-centered velocities to enforce that they satisfy</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot (U^{MAC})  = 0\]</div>
<p>We do this by solving</p>
<div class="math notranslate nohighlight">
\[\nabla \cdot \frac{1}{\rho} \nabla \phi^{MAC} = \nabla \cdot \left(U^{pred} \right)\]</div>
<p>then defining</p>
<div class="math notranslate nohighlight">
\[U^{MAC} = U^{pred} - \frac{1}{\rho} \nabla \phi^{MAC}\]</div>
<hr class="docutils" />
<p>We extrapolate the normal velocities to cell faces using a second-order Taylor series expansion
in space and time. For each face with a non-zero area fraction, we extrapolate the normal velocity
component from the centroids of the cells on either side to the face centroid, creating left (L)
and right (R) states. For face <span class="math notranslate nohighlight">\((i+1/2,j,k)\)</span> this gives</p>
<div class="math notranslate nohighlight" id="equation-eq1">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq1" title="Permalink to this equation">¶</a></span>\[\begin{split}\tilde{u}_{i+\frac{1}{2},j,k}^{L,{n+\frac{1}{2}}} &amp; \approx u_{i,j,k}^n + \frac{dx}{2} u_x + \frac{dt}{2} u_t \\
 &amp; = u_{i,j,k}^n + \left( \frac{dx}{2} - u^n_{i,j,k} \frac{dt}{2} \right) (u_x^{n,lim})_{i,j,k} \\
 &amp; + \frac{dt}{2} (-(\widehat{v u_y})_{i,j,k} - (\widehat{w u_z})_{i,j,k} + f_{x,i,j,k}^n)\end{split}\]</div>
<p>extrapolated from <span class="math notranslate nohighlight">\((i,j,k)\)</span>, and</p>
<div class="math notranslate nohighlight" id="equation-eq2">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq2" title="Permalink to this equation">¶</a></span>\[\begin{split} \tilde{u}_{i+\frac{1}{2},j,k}^{R,{n+\frac{1}{2}}} &amp; \approx u_{i+1,j,k}^n - \frac{dx}{2} u_x + \frac{dt}{2} u_t \\
 &amp; = u_{i+1,j,k}^n - \left( \frac{dx}{2} + u^n_{i+1,j,k} \frac{dt}{2} \right)(u^{n,lim}_x)_{i+1,j,k} \\
 &amp; + \frac{dt}{2} (-(\widehat{v u_y})_{i+1,j,k} - (\widehat{w u_z})_{i+1,j,k} + f_{x,i+1,j,k}^n)\end{split}\]</div>
<p>extrapolated from <span class="math notranslate nohighlight">\((i+1,j,k).\)</span> Here, <span class="math notranslate nohighlight">\(f\)</span> is the sum of external forces, discussed later.</p>
<p>In evaluating these terms the first derivatives normal to the face (in this
case <span class="math notranslate nohighlight">\(u_x^{n,lim}\)</span>) are evaluated using a monotonicity-limited fourth-order
slope approximation. The limiting is done on each component of the velocity at time <span class="math notranslate nohighlight">\(n\)</span> individually. When one of the cells on either side is a cut cell, we
instead use a least squares fit centered on <span class="math notranslate nohighlight">\((i,j,k)\)</span> that uses
all regular and cut-cell neighbors, compute slopes in all three coordinate directions. We then define the left and right states by extrapolating from the cell centroid to the face centroid using slopes in all three coordinate directions
as necessary.</p>
<p>The transverse derivative terms (<span class="math notranslate nohighlight">\(\widehat{v u_y}\)</span> and
<span class="math notranslate nohighlight">\(\widehat{w u_z}\)</span> in this case)
are evaluated by first extrapolating all velocity components
to the transverse faces from the cell centers on either side,
then choosing between these states using the upwinding procedure
defined below.  In particular, in the <span class="math notranslate nohighlight">\(y\)</span> direction we define</p>
<div class="math notranslate nohighlight">
\[\hat{\boldsymbol{U}}^F_{i,j+\frac{1}{2},k} =  \boldsymbol{U}_{i,j,k}^n +
\left( \frac{dy}{2} - \frac{dt}{2} v_{i,j,k}^n \right)
(\boldsymbol{U}^{n,lim}_y)_{i,j,k}  \;\;\;\]</div>
<div class="math notranslate nohighlight">
\[\hat{\boldsymbol{U}}^B_{i,j+\frac{1}{2},k} =  \boldsymbol{U}_{i,j+1,k}^n -
\left( \frac{dy}{2} + \frac{dt}{2} v_{i,j+1,k}^n \right)
(\boldsymbol{U}^{n,lim}_y)_{i,j+1,k} \;\;\;\]</div>
<p>Values are similarly traced from <span class="math notranslate nohighlight">\((i,j,k)\)</span> and <span class="math notranslate nohighlight">\((i,j,k+1)\)</span>
to the <span class="math notranslate nohighlight">\((i,j,k+\frac{1}{2})\)</span> faces to define
<span class="math notranslate nohighlight">\(\hat{\boldsymbol{U}}^D_{i,j,k+\frac{1}{2}}\)</span> and
<span class="math notranslate nohighlight">\(\hat{\boldsymbol{U}}^{U}_{i,j,k+\frac{1}{2}}\)</span>, respectively.</p>
<p>In this upwinding procedure we first define a normal advective
velocity on the face
(suppressing the <span class="math notranslate nohighlight">\(({i,j+\frac{1}{2},k})\)</span> spatial indices on front and back
states here and in the next equation):</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{v}^{adv}_{{i,j+\frac{1}{2},k}} = \left\{\begin{array}{lll}
 \widehat{v}^F &amp; \mbox{if $\widehat{v}^F &gt; 0, \;\; \widehat{v}^F + \widehat{v}^B
 &gt; 0$} \\
 0   &amp; \mbox{if $\widehat{v}^F \leq 0, \widehat{v}^B \geq  0$ or
$\widehat{v}^F + \widehat{v}^B = 0$ } \\
 \widehat{v}^B &amp; \mbox{if $\widehat{v}^B &lt; 0, \;\; \widehat{v}^F + \widehat{v}^B
 &lt; 0$ .} \end{array} \right.\end{split}\]</div>
<p>We now upwind <span class="math notranslate nohighlight">\(\widehat{\boldsymbol{U}}\)</span> based on <span class="math notranslate nohighlight">\(\widehat{v}_{{i,j+\frac{1}{2},k}}^{adv}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\widehat{\boldsymbol{U}}_{{i,j+\frac{1}{2},k}} = \left\{\begin{array}{lll}
 \widehat{\boldsymbol{U}}^F &amp; \mbox{if $\widehat{v}_{{i,j+\frac{1}{2},k}}^{adv} &gt; 0$} \\
\frac{1}{2} (\widehat{\boldsymbol{U}}^F + \widehat{\boldsymbol{U}}^B)  &amp; \mbox{if $\widehat{v}_{{i,j+\frac{1}{2},k}}^{adv} = 0
$} \\
 \widehat{\boldsymbol{U}}^B &amp;
\mbox{if $\widehat{v}_{{i,j+\frac{1}{2},k}}^{adv} &lt; 0$} \end{array} \right.\end{split}\]</div>
<p>After constructing <span class="math notranslate nohighlight">\(\widehat{\boldsymbol{U}}_{{i,j-\frac{1}{2},k}}, \widehat{\boldsymbol{U}}_{i,j,k+\frac{1}{2}}\)</span>
and <span class="math notranslate nohighlight">\(\widehat{\boldsymbol{U}}_{i,j,k-\frac{1}{2}}\)</span> in a similar manner,
we use these upwind values to form the transverse derivatives in
Eqs. <a class="reference internal" href="#equation-eq1">(1)</a> and <a class="reference internal" href="#equation-eq2">(2)</a> :</p>
<div class="math notranslate nohighlight">
\[(\widehat{v u_y})_{i,j,k} = \frac{1}{2dy} ( \widehat{v}_{{i,j+\frac{1}{2},k}}^{adv} +
\widehat{v}_{{i,j-\frac{1}{2},k}}^{adv} ) ( \widehat{u}_{{i,j+\frac{1}{2},k}} - \widehat{u}_{{i,j-\frac{1}{2},k}} )\]</div>
<div class="math notranslate nohighlight">
\[(\widehat{w u_z})_{i,j,k} = \frac{1}{2dz} (\widehat{w}_{i,j,k+\frac{1}{2}}^{adv} +
\widehat{w}_{i,j,k-\frac{1}{2}}^{adv} ) ( \widehat{u}_{i,j,k+\frac{1}{2}} - \widehat{u}_{i,j,k-\frac{1}{2}} )\]</div>
<p>The normal velocity at each face is then determined by an upwinding procedure
based on the states predicted from the cell centers on either side.  The
procedure is similar to that described above, i.e.
(suppressing the (<span class="math notranslate nohighlight">\(i+\frac{1}{2},j,k\)</span>) indices)</p>
<div class="math notranslate nohighlight">
\[\begin{split}\tilde{u}^{n+\frac{1}{2}}_{{i+\frac{1}{2},j,k}} = \left\{\begin{array}{lll}
\tilde{u}^{L,n+\frac{1}{2}}
&amp; \mbox{if $\tilde{u}^{L,n+\frac{1}{2}} &gt; 0$ and $ \tilde{u}^{L,n+\frac{1}{2}} +
\tilde{u}^{R,n+\frac{1}{2}} &gt; 0$} \\
0 &amp; \mbox{if $\tilde{u}^{L,n+\frac{1}{2}} \leq 0, \tilde{u}^{R,n+\frac{1}{2}} \geq  0$ or
$\tilde{u}^{L,n+\frac{1}{2}} + \tilde{u}^{R,n+\frac{1}{2}} = 0$ } \\
\tilde{u}^{R,n+\frac{1}{2}}
&amp; \mbox{if $\tilde{u}^{R,n+\frac{1}{2}} &lt; 0$ and $\tilde{u}^{L,n+\frac{1}{2}}
+ \tilde{u}^{R,n+\frac{1}{2}} &lt; 0$}
\end{array} \right.\end{split}\]</div>
<p>We follow a similar
procedure to construct <span class="math notranslate nohighlight">\(\tilde{v}^{n+\frac{1}{2}}_{i,j+\frac{1}{2},k}\)</span>
and <span class="math notranslate nohighlight">\(\tilde{w}^{n+\frac{1}{2}}_{i,j,k+\frac{1}{2}}\)</span>. We refer to this unique value of
normal velocity on each face as <span class="math notranslate nohighlight">\(\boldsymbol{U}^{MAC,*}\)</span>.</p>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="EBMOL.html" class="btn btn-neutral float-right" title="EBMOL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="AMReX-Hydro" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2018, AMReX-Hydro Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>