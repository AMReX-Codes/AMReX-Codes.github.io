

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Compiling AMReX with Sundials version 3.X or later &mdash; amrex 20.02-dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SWFFT" href="SWFFT.html" />
    <link rel="prev" title="Compiling AMReX with CVODE (Cray or Sundials version 2.7)" href="CVODE.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> amrex
          

          
          </a>

          
            
            
              <div class="version">
                20.02-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">AMReX Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted_Chapter.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAMReX_Chapter.html">Building AMReX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basics_Chapter.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrCore_Chapter.html">AmrCore Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrLevel_Chapter.html">Amr Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="AsyncIter_Chapter.html">Asynchronous Iterators (AmrTask)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkJoin.html">Fork-Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO_Chapter.html">I/O (Plotfile, Checkpoint)</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinearSolvers_Chapter.html">Linear Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particle_Chapter.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fortran_Chapter.html">Fortran Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="EB_Chapter.html">Embedded Boundaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPU_Chapter.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visualization_Chapter.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inputs_Chapter.html">Run-time Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMReX_Profiling_Tools_Chapter.html">AMReX-based Profiling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="External_Profiling_Tools_Chapter.html">External Profiling Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="External_Frameworks_Chapter.html">External Frameworks</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="CVODE_top.html">CVODE</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="CVODE.html">Compiling AMReX with CVODE (Cray or Sundials version 2.7)</a></li>
<li class="toctree-l3"><a class="reference internal" href="CVODE.html#cvode-tutorials">CVODE Tutorials</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Compiling AMReX with Sundials version 3.X or later</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sundials-3-x-tutorials">SUNDIALS 3.X Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SWFFT.html">SWFFT</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Regression_Testing_Chapter.html">Regression Testing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="External_Frameworks_Chapter.html">External Frameworks</a> &raquo;</li>
        
          <li><a href="CVODE_top.html">CVODE</a> &raquo;</li>
        
      <li>Compiling AMReX with Sundials version 3.X or later</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/SUNDIALS3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compiling-amrex-with-sundials-version-3-x-or-later">
<h1>Compiling AMReX with Sundials version 3.X or later<a class="headerlink" href="#compiling-amrex-with-sundials-version-3-x-or-later" title="Permalink to this headline">¶</a></h1>
<p>The following steps describe how to compile an AMReX application with
SUNDIALS_3.X support.  On Cray systems (e.g., Cori or Edison at NERSC), Cray provides
a system module called <code class="docutils literal notranslate"><span class="pre">cray-tpsl</span></code> (“Cray Third-Party Scientific Libraries”)
which as of this writing contains the 2.7 version of the SUNDIALS solver suite (including
CVODE).</p>
<p>In order to use the Sundials 3.X version:</p>
<ol class="arabic">
<li><p>Obtain the CVODE source code, which is hosted here:
<a class="reference external" href="https://computation.llnl.gov/projects/sundials/sundials-software">https://computation.llnl.gov/projects/sundials/sundials-software</a>.
One can download either the complete SUNDIALS package, or just the CVODE components.</p></li>
<li><p>Unpack the CVODE / SUNDIALS tarball, and create a new “build” directory (it
can be anywhere).</p></li>
<li><p>Navigate to the new, empty build directory, and type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> \
  <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="p">:</span><span class="n">PATH</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="nb">dir</span> \
  <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cvode</span><span class="o">/</span><span class="ow">or</span><span class="o">/</span><span class="n">sundials</span><span class="o">/</span><span class="n">top</span><span class="o">/</span><span class="n">level</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="nb">dir</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_DIR</span></code> option tells CMake where to install the libraries.
Note that CMake will attempt to deduce the compilers automatically, but
respects certain environment variables if they are defined, such as <code class="docutils literal notranslate"><span class="pre">CC</span></code>
(for the C compiler), <code class="docutils literal notranslate"><span class="pre">CXX</span></code> (for the C++ compiler), and <code class="docutils literal notranslate"><span class="pre">FC</span></code> (for the
Fortran compiler).  So one may modify the above CMake invocation to be
something like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CC</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">gcc</span> \
<span class="n">CXX</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">g</span><span class="o">++</span> \
<span class="n">FC</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">gfortran</span> \
  <span class="n">cmake</span> \
  <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="p">:</span><span class="n">PATH</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">install</span><span class="o">/</span><span class="nb">dir</span> \
  <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cvode</span><span class="o">/</span><span class="ow">or</span><span class="o">/</span><span class="n">sundials</span><span class="o">/</span><span class="n">top</span><span class="o">/</span><span class="n">level</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="nb">dir</span>
</pre></div>
</div>
<p>One can supply additional flags to CMake or to the compiler to customize the
compilation process.  Flags of interest may include <code class="docutils literal notranslate"><span class="pre">CMAKE_C_FLAGS</span></code>, which
add the specified flags to the compile statement, e.g.,
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_C_FLAGS=&quot;-h</span> <span class="pre">list=a&quot;</span></code> will append the <code class="docutils literal notranslate"><span class="pre">-h</span> <span class="pre">list=a</span></code> flag to the
<code class="docutils literal notranslate"><span class="pre">cc</span></code> statement when compiling the source code.  Here one may wish to add
something like <code class="docutils literal notranslate"><span class="pre">&quot;-O2</span> <span class="pre">-g&quot;</span></code> to provide an optimized library that still
contains debugging symbols; if one neglects debugging symbols in the CVODE
library, and if a code that uses CVODE encounters a segmentation fault in
the solve, then the backtrace has no information about where in the solver
the error occurred.  Also, if one wishes to compile only the solver library
itself and not the examples that come with the source (compiling the
examples is enabled by default), one can add <code class="docutils literal notranslate"><span class="pre">&quot;-DEXAMPLES_ENABLE=OFF&quot;</span></code>.
Users should be aware that the CVODE examples are linked dynamically, so
when compiling the solver library on Cray system using the Cray compiler
wrappers <code class="docutils literal notranslate"><span class="pre">cc</span></code>, <code class="docutils literal notranslate"><span class="pre">CC</span></code>, and <code class="docutils literal notranslate"><span class="pre">ftn</span></code>, one should explicitly disable
compiling the examples via the <code class="docutils literal notranslate"><span class="pre">&quot;-DEXAMPLES_ENABLE=OFF&quot;</span></code> flag.</p>
</li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">GNUmakefile</span></code> for the  application which uses the Fortran 2003
interface to CVODE or ARKODE, add <code class="docutils literal notranslate"><span class="pre">SUNDIALS_3x4x</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>, which will compile the Fortran 2003
interfaces and link the  libraries.  Note that one must define the
<code class="docutils literal notranslate"><span class="pre">CVODE_LIB_DIR</span></code> environment variable to point to the location where the
libraries are installed.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">GNUmakefile</span></code> for the  application which uses the Fortran 2003
interface to ARKODE, also add <code class="docutils literal notranslate"><span class="pre">USE_ARKODE_LIBS</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>. It is assumed that the
<code class="docutils literal notranslate"><span class="pre">CVODE_LIB_DIR</span></code> environment variable points to the location where the ARKODE
libraries are installed as well.</p></li>
<li><p>Fortran 2003 interfaces for the pgi compilers and for developmental versions of SUNDIALS
are currently not supported.</p></li>
</ol>
</div>
<div class="section" id="sundials-3-x-tutorials">
<h1>SUNDIALS 3.X Tutorials<a class="headerlink" href="#sundials-3-x-tutorials" title="Permalink to this headline">¶</a></h1>
<p>AMReX provides six tutorials in the <code class="docutils literal notranslate"><span class="pre">amrex/Tutorials/CVODE/SUNDIALS3_finterface</span></code> directory.
<code class="docutils literal notranslate"><span class="pre">EX1</span></code> is modeled after the CVODE Tutorial <code class="docutils literal notranslate"><span class="pre">EX1</span></code> showing use with AMReX.
The four <code class="docutils literal notranslate"><span class="pre">EX_cv_*</span></code> tutorials are based on examples provided with the interface, which
are more closely modeled after CVODE examples. The <code class="docutils literal notranslate"><span class="pre">EX_ark_analytic_fp</span></code> tutorial is based
on the <code class="docutils literal notranslate"><span class="pre">EX_cv_analytic_fp</span></code> tutorial, but uses ARKODE instead of CVODE.</p>
<p>AMReX provides three tutorials in the <code class="docutils literal notranslate"><span class="pre">amrex/Tutorials/CVODE/SUNDIALS3_cppversion</span></code> directory.
These are versions of <code class="docutils literal notranslate"><span class="pre">EX1</span></code> which operate on a packed version of the data. <code class="docutils literal notranslate"><span class="pre">EX1_SERIAL_NVEC</span></code>
packs a box worth of equations into a serial NVector, uses CVODE to solve, and then unpacks
the solution back into the box it came from. <code class="docutils literal notranslate"><span class="pre">EX1_CUDA_NVEC</span></code> uses the cuda NVector implementation instead.
<code class="docutils literal notranslate"><span class="pre">EX1_GPU_PRAGMA</span></code> uses the cuda NVector, and the gpu pragma functionality.</p>
<span class="target" id="sundials3"></span></div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="SWFFT.html" class="btn btn-neutral float-right" title="SWFFT" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="CVODE.html" class="btn btn-neutral float-left" title="Compiling AMReX with CVODE (Cray or Sundials version 2.7)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, AMReX Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>