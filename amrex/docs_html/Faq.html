<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frequently Asked Questions &mdash; amrex 25.06-dev documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/theme_overrides.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="AMReX Governance" href="Governance.html" />
    <link rel="prev" title="Continuous Compilation Testing" href="Testing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            amrex
          </a>
              <div class="version">
                25.06-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">AMReX Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted_Chapter.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAMReX_Chapter.html">Building AMReX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basics_Chapter.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrCore_Chapter.html">AmrCore Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrLevel_Chapter.html">Amr Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkJoin.html">Fork-Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO_Chapter.html">I/O (Plotfile, Checkpoint)</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinearSolvers_Chapter.html">Linear Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particle_Chapter.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fortran_Chapter.html">Fortran Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python_Chapter.html">Python Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="EB_Chapter.html">Embedded Boundaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="FFT_Chapter.html">Discrete Fourier Transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeIntegration_Chapter.html">Time Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPU_Chapter.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visualization_Chapter.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Post_Processing_Chapter.html">Post-Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="RuntimeParameters.html">Runtime Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMReX_Profiling_Tools_Chapter.html">AMReX-based Profiling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="External_Profiling_Tools_Chapter.html">External Profiling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="External_Frameworks_Chapter.html">External Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Regression_Testing_Chapter.html">Regression Testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#more-questions">More Questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Governance.html">AMReX Governance</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Frequently Asked Questions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Faq.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this heading"></a></h1>
<p><strong>Q.</strong> Why am I getting a segmentation fault after my code runs?</p>
<p><strong>A.</strong> Do you have <code class="code cpp docutils literal notranslate"><span class="pre">amrex::Initialize();</span> <span class="pre">{</span></code> and <code class="code cpp docutils literal notranslate"><span class="pre">}</span> <span class="pre">amrex::Finalize();</span></code>
at the beginning and end of your code? For all AMReX commands to function
properly, including to release resources, they need to be contained
between these two curly braces or in a separate function. In the <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/Basics.html#initialize-and-finalize">Initialize
and Finalize</a> section, these commands are discussed further detail.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> I want to use a different compiler with GNU Make to compile AMReX. How do I do this?</p>
<p><strong>A.</strong> In the file <code class="docutils literal notranslate"><span class="pre">amrex/Tools/GNUMake/Make.local</span></code> you can specify your own compile
commands by setting the variables <code class="docutils literal notranslate"><span class="pre">CXX</span></code>, <code class="docutils literal notranslate"><span class="pre">CC</span></code>, <code class="docutils literal notranslate"><span class="pre">FC</span></code>, and <code class="docutils literal notranslate"><span class="pre">F90</span></code>.
An example can be found at <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/BuildingAMReX.html#specifying-your-own-compiler">Specifying your own compiler</a> . Additional
customizations are described in the file, <code class="docutils literal notranslate"><span class="pre">amrex/Tools/GNUMake/Make.local.template</span></code>.
In the same directory, <code class="docutils literal notranslate"><span class="pre">amrex/Tools/GNUMake/README.md</span></code> contains detailed
information on compiler commands.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> I’m having trouble compiling my code.</p>
<p><strong>A.</strong> AMReX developers have found that running the command <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> can resolve
many compilation issues.</p>
<p>If you are working in an environment that uses
a module system, please ensure you have the correct modules loaded. Typically, to do this,
type <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">list</span></code> at the command prompt.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> When I profile my code that uses GPUs with <code class="docutils literal notranslate"><span class="pre">TINY_PROFILE=TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">PROFILE=TRUE</span></code>
my timings are inconsistent.</p>
<p><strong>A.</strong> Due to the asynchronous nature of GPU execution, profilers might only
measure the run time on CPU, if there is no explicit synchronization.  For
<code class="docutils literal notranslate"><span class="pre">TINY_PROFILE</span></code>, one could use <code class="code cpp docutils literal notranslate"><span class="pre">ParmParse</span></code> parameter
<code class="docutils literal notranslate"><span class="pre">tiny_profiler.device_synchronize_around_region=1</span></code> to add synchronization.
Note that this may degrade performance.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> How do I know I am getting the right answer?</p>
<p><strong>A.</strong> AMReX provides support for verifying output with several tools. To briefly mention a few:</p>
<ul class="simple">
<li><p>The <code class="code cpp docutils literal notranslate"><span class="pre">print_state</span></code> function can be used to output the data of a single cell.</p></li>
<li><p><code class="code cpp docutils literal notranslate"><span class="pre">VisMF::Write</span></code> can be used to write MultiFab data to disk that can be viewed with <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/Visualization.html#sec-amrvis">Amrvis</a>.</p></li>
<li><p><code class="code cpp docutils literal notranslate"><span class="pre">amrex::Print()</span></code> and <code class="code cpp docutils literal notranslate"><span class="pre">amrex::AllPrint()</span></code> are useful for printing
output when using multiple processes or threads as it prevents messages
from getting mixed up.</p></li>
<li><p><a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/Post_Processing.html#fcompare">fcompare</a> compares two plotfiles and reports absolute and relative error.</p></li>
</ul>
<p>Additional tools and discussion on this topic is contained
in the section <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/Basics.html#debugging">Debugging</a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> What’s the difference between <code class="code cpp docutils literal notranslate"><span class="pre">Copy</span></code> and <code class="code cpp docutils literal notranslate"><span class="pre">ParallelCopy</span></code> for
<code class="code cpp docutils literal notranslate"><span class="pre">MultiFab</span></code> data?</p>
<p><strong>A.</strong> <code class="code cpp docutils literal notranslate"><span class="pre">MultiFab::Copy</span></code> is for two <code class="code cpp docutils literal notranslate"><span class="pre">MultiFab</span></code>s built with the same
<code class="code cpp docutils literal notranslate"><span class="pre">BoxArray</span></code> and <code class="code cpp docutils literal notranslate"><span class="pre">DistributionMapping</span></code>, whereas <code class="code cpp docutils literal notranslate"><span class="pre">ParallelCopy</span></code>
is for parallel communication of two <code class="code cpp docutils literal notranslate"><span class="pre">MultiFab</span></code>s with different
<code class="code cpp docutils literal notranslate"><span class="pre">BoxArray</span></code> and/or <code class="code cpp docutils literal notranslate"><span class="pre">DistributionMapping</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> How do I fill ghost cells?</p>
<p><strong>A.</strong> See <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/Basics.html#ghost-cells">Ghost Cells</a> in the AMReX Source Documentation.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> What’s the difference between <code class="docutils literal notranslate"><span class="pre">AmrCore</span></code> and <code class="docutils literal notranslate"><span class="pre">AmrLevel</span></code>? How do
I decide which to use?</p>
<p><strong>A.</strong> The <code class="code cpp docutils literal notranslate"><span class="pre">AmrLevel</span></code> class is an abstract base class that holds data
for a single AMR level.  A vector of <code class="code cpp docutils literal notranslate"><span class="pre">AmrLevel</span></code> is stored in the
<code class="code cpp docutils literal notranslate"><span class="pre">Amr</span></code> class, which is derived from <code class="code cpp docutils literal notranslate"><span class="pre">AmrCore</span></code>.  An application code
can derive from <code class="code cpp docutils literal notranslate"><span class="pre">AmrLevel</span></code> and override functions.  <code class="code cpp docutils literal notranslate"><span class="pre">AmrCore</span></code>
contains the meta-data for the AMR hierarchy, but it does not contain any
floating point mesh data.  Instead of using <code class="code cpp docutils literal notranslate"><span class="pre">Amr</span></code>/<code class="code cpp docutils literal notranslate"><span class="pre">AmrLevel</span></code>, an
application can also derive from <code class="code cpp docutils literal notranslate"><span class="pre">AmrCore</span></code>.  If you want flexibility,
you might choose the <code class="code cpp docutils literal notranslate"><span class="pre">AmrCore</span></code> approach, otherwise the <code class="code cpp docutils literal notranslate"><span class="pre">AmrLevel</span></code>
approach might be easier because it already has a lot of built-in
capabilities that are common for AMR applications.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> For GPU usage, how can I perform explicit host to device and
device to host copies without relying on managed memory?</p>
<p><strong>A.</strong> Use <code class="docutils literal notranslate"><span class="pre">The_Pinned_Arena()</span></code> (See <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/GPU.html#memory-allocation">Memory Allocation</a> in the AMReX
Source Documentation.) and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">htod_memcpy</span> <span class="p">(</span><span class="n">void</span><span class="o">*</span> <span class="n">p_d</span><span class="p">,</span> <span class="n">const</span> <span class="n">void</span><span class="o">*</span> <span class="n">p_h</span><span class="p">,</span> <span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">size_t</span> <span class="n">sz</span><span class="p">);</span>
<span class="n">void</span> <span class="n">dtoh_memcpy</span> <span class="p">(</span><span class="n">void</span><span class="o">*</span> <span class="n">p_h</span><span class="p">,</span> <span class="n">const</span> <span class="n">void</span><span class="o">*</span> <span class="n">p_d</span><span class="p">,</span> <span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">size_t</span> <span class="n">sz</span><span class="p">);</span>
<span class="n">void</span> <span class="n">dtoh_memcpy</span> <span class="p">(</span><span class="n">FabArray</span><span class="o">&lt;</span><span class="n">FAB</span><span class="o">&gt;&amp;</span> <span class="n">dst</span><span class="p">,</span> <span class="n">FabArray</span><span class="o">&lt;</span><span class="n">FAB</span><span class="o">&gt;</span> <span class="n">const</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">,</span> <span class="nb">int</span> <span class="n">scomp</span><span class="p">,</span> <span class="nb">int</span> <span class="n">dcomp</span><span class="p">,</span> <span class="nb">int</span> <span class="n">ncomp</span><span class="p">);</span>
<span class="n">void</span> <span class="n">htod_memcpy</span> <span class="p">(</span><span class="n">FabArray</span><span class="o">&lt;</span><span class="n">FAB</span><span class="o">&gt;&amp;</span> <span class="n">dst</span><span class="p">,</span> <span class="n">FabArray</span><span class="o">&lt;</span><span class="n">FAB</span><span class="o">&gt;</span> <span class="n">const</span><span class="o">&amp;</span> <span class="n">src</span><span class="p">,</span> <span class="nb">int</span> <span class="n">scomp</span><span class="p">,</span> <span class="nb">int</span> <span class="n">dcomp</span><span class="p">,</span> <span class="nb">int</span> <span class="n">ncomp</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> How do I generate random numbers with AMReX? Can I set the seed?
Are they thread safe with MPI and OpenMP?</p>
<p><strong>A.</strong> (Thread safe) Yes, <code class="code cpp docutils literal notranslate"><span class="pre">amrex::Random()</span></code> is thread safe. When OpenMP is on,
each thread will have its own dedicated Random Number Generator that
is totally independent of the others.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> Is Dirichlet boundary condition data loaded into cell-centered, or
face-centered containers? How is it used in AMReX-based codes like MLMG and the
advection routines in AMReX-Hydro?</p>
<p><strong>A.</strong> In the cell-centered MLMG solver, the Dirichlet boundary data are stored
in containers that have the information of the location of the data.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> How does coarse-grained OpenMP parallelism work in AMReX? How is it
different from the fine-grained approach?</p>
<p><strong>A.</strong> Our OpenMP strategy is explained in this paper, <a class="reference external" href="https://arxiv.org/abs/1604.03570">https://arxiv.org/abs/1604.03570</a>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><strong>Q.</strong> How to avoid running into <code class="code cpp docutils literal notranslate"><span class="pre">Formal</span> <span class="pre">parameter</span> <span class="pre">space</span> <span class="pre">overflowed</span></code> CUDA error
while building complex EB geometries using AMReX implicit functions and CSG functionalities ?</p>
<p><strong>A.</strong> AMReX enables logical operations and transformations to assemble basic shapes <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/EB.html#initializing-the-geometric-database">Implicit Functions</a>
into complex geometries. Each operation results in a more complex type which can eventually overflow the
parameter space (4096 bytes on CUDA 11.4 for instance). To circumvent the problem, explicitly copy the object
to the device and pass a device pointer function object <cite>DevicePtrIF</cite> into the <cite>EB2</cite> function using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">IF_t</span> <span class="o">=</span> <span class="n">decltype</span><span class="p">(</span><span class="n">myComplexIF</span><span class="p">);</span>
<span class="n">IF_t</span><span class="o">*</span> <span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">IF_t</span><span class="o">*</span><span class="p">)</span><span class="n">The_Arena</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">alloc</span><span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">myComplexIF</span><span class="p">));</span>
<span class="n">Gpu</span><span class="p">::</span><span class="n">htod_memcpy_async</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">myComplexIF</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">IF_t</span><span class="p">));</span>
<span class="n">Gpu</span><span class="p">::</span><span class="n">streamSynchronize</span><span class="p">();</span>
<span class="n">EB2</span><span class="p">::</span><span class="n">DevicePtrIF</span><span class="o">&lt;</span><span class="n">IF_t</span><span class="o">&gt;</span> <span class="n">dp_myComplexIF</span><span class="p">{</span><span class="n">dp</span><span class="p">};</span>
<span class="n">auto</span> <span class="n">gshop</span> <span class="o">=</span> <span class="n">EB2</span><span class="p">::</span><span class="n">makeShop</span><span class="p">(</span><span class="n">dp_myComplexIF</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<section id="more-questions">
<h2>More Questions<a class="headerlink" href="#more-questions" title="Permalink to this heading"></a></h2>
<p>If your question was not addressed here, you are encouraged to
search and ask for help on the <a class="reference external" href="https://github.com/AMReX-Codes/amrex/discussions">AMReX GitHub Discussions</a> page.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Testing.html" class="btn btn-neutral float-left" title="Continuous Compilation Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Governance.html" class="btn btn-neutral float-right" title="AMReX Governance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, AMReX Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>