<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Continuous Compilation Testing &mdash; amrex 21.10-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Regression Testing" href="Regression_Testing_Chapter.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> amrex
          </a>
              <div class="version">
                21.10-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">AMReX Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted_Chapter.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAMReX_Chapter.html">Building AMReX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basics_Chapter.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrCore_Chapter.html">AmrCore Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrLevel_Chapter.html">Amr Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkJoin.html">Fork-Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO_Chapter.html">I/O (Plotfile, Checkpoint)</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinearSolvers_Chapter.html">Linear Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particle_Chapter.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fortran_Chapter.html">Fortran Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="EB_Chapter.html">Embedded Boundaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPU_Chapter.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visualization_Chapter.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Post_Processing_Chapter.html">Post-Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inputs_Chapter.html">Run-time Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMReX_Profiling_Tools_Chapter.html">AMReX-based Profiling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="External_Profiling_Tools_Chapter.html">External Profiling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="External_Frameworks_Chapter.html">External Frameworks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Regression_Testing_Chapter.html">Regression Testing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Continuous Compilation Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nightly-regression-testing">Nightly Regression Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-test-suite-locally">Running the test suite locally</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-test">Adding a new test</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="Regression_Testing_Chapter.html">Regression Testing</a> &raquo;</li>
      <li>Continuous Compilation Testing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Testing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="continuous-compilation-testing">
<h1>Continuous Compilation Testing<a class="headerlink" href="#continuous-compilation-testing" title="Permalink to this headline"></a></h1>
<p>As a first line of testing, on every commit to the repository, we verify that we can compile
AMReX as a library for a common set of configuration options. This operation is performed
through Travis-CI. This layer of testing is deliberately limited, so that it can be run
quickly on every commit. For more extensive testing, we rely on the nightly regression results.</p>
</div>
<div class="section" id="nightly-regression-testing">
<h1>Nightly Regression Testing<a class="headerlink" href="#nightly-regression-testing" title="Permalink to this headline"></a></h1>
<p>Each night, we automically run a suite of tests, both on AMReX itself, and on a most of the major
application codes that use it as a framework. We use an in-house test runner script to manage this
operation, originally developed by Michael Zingale for the Castro code, and later expanded to other
application codes as well. The results for each night are collected and stored on a web page; see
<a class="reference external" href="https://ccse.lbl.gov/pub/RegressionTesting/">https://ccse.lbl.gov/pub/RegressionTesting/</a> for the latest set of results.</p>
</div>
<div class="section" id="running-the-test-suite-locally">
<h1>Running the test suite locally<a class="headerlink" href="#running-the-test-suite-locally" title="Permalink to this headline"></a></h1>
<p>The test suite is mostly used internally by AMReX developers. However,
f you are making a pull request to AMReX, it can be useful to run the test suite
on your local machine, to reduce the liklihood that your changes break some existing functionality.
To run the test suite on locally, you must first obtain a copy of the test runner source, available
on Github here: <a class="reference external" href="https://github.com/AMReX-Codes/regression_testing">https://github.com/AMReX-Codes/regression_testing</a>. The test runner requires Python
version 2.7 or greater.</p>
<p>Next, you need a configuration file that defines which tests to run, which amrex repository to test,
which branch to use, etc. A sample configuration file for AMReX is distributed with the amrex source
code at <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">amrex</span></span><span class="operator"><span class="pre">/</span></span><span class="name"><span class="pre">Tools</span></span><span class="operator"><span class="pre">/</span></span><span class="name"><span class="pre">RegressionTesting</span></span><span class="operator"><span class="pre">/</span></span><span class="name"><span class="pre">AMReX</span></span><span class="operator"><span class="pre">-</span></span><span class="name"><span class="pre">tests</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">ini</span></span></code>. You will need to modify a few of the entries
to, for example, point the test runner to the clone of amrex on your local machine. Entries you will
likely want to change include:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">testTopDir</span> <span class="o">=</span> /path/to/test/output <span class="c1"># the tests results and benchmarks will stored here</span>
<span class="nv">webTopDir</span>  <span class="o">=</span> /path/to/web/output  <span class="c1"># a web page with the test results will be written here</span>
</pre></div>
</div>
<p>to control where the generated output will be written, and</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>AMReX<span class="o">]</span>
<span class="nv">dir</span> <span class="o">=</span> /path/to/amrex  <span class="c1"># the path to the amrex repository you want to test</span>
<span class="nv">branch</span> <span class="o">=</span> <span class="s2">&quot;development&quot;</span>
</pre></div>
</div>
<p>to control which repository and branch to test.</p>
<p>The test runner is a Python script and can be invoked like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python regtest.py &lt;options&gt; AMReX-Tests.ini
</pre></div>
</div>
<p>Before you can use it, you must first generate a set of “benchmarks” - i.e. known “good” answers to the
tests that will be run. If you are testing a pull request, you can generate these by running the script
with the a recent version of the <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">development</span></span></code> branch of AMReX. You can generate the benchmarks like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python regtest.py --make_benchmarks <span class="s1">&#39;generating initial benchmarks&#39;</span> AMReX-Tests.ini
</pre></div>
</div>
<p>Once that is finished, you can switch over to the branch you want to test in <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">AMReX</span></span><span class="operator"><span class="pre">-</span></span><span class="name"><span class="pre">Tests</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">ini</span></span></code>, and then
re-run the script without the <code class="code cpp c++ docutils literal notranslate"><span class="operator"><span class="pre">--</span></span><span class="name"><span class="pre">make_benchmarks</span></span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python regtest.py --make_benchmarks <span class="s1">&#39;generating initial benchmarks&#39;</span> AMReX-Tests.ini
</pre></div>
</div>
<p>The script will generate a set of html pages in the directory specified in your <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">AMReX</span></span><span class="operator"><span class="pre">-</span></span><span class="name"><span class="pre">Tests</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">ini</span></span></code>
file that you can examine using the browser of your choice.</p>
<p>For a complete set of script options, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python regtest.py --help
</pre></div>
</div>
<p>A particularly useful option lets you run just a subset of the complete test suite. To run only one test, you can do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python regtest.py --single_test &lt;TestName&gt; AMReX-Tests.ini
</pre></div>
</div>
<p>To run an enumerated list of tests, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python regtest.py --tests <span class="s1">&#39;&lt;TestName1&gt; &lt;TestName2&gt; &lt;TestName3&gt;&#39;</span> AMReX-Tests.ini
</pre></div>
</div>
</div>
<div class="section" id="adding-a-new-test">
<h1>Adding a new test<a class="headerlink" href="#adding-a-new-test" title="Permalink to this headline"></a></h1>
<p>New tests can be added to the suite by modifying the <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">AMReX</span></span><span class="operator"><span class="pre">-</span></span><span class="name"><span class="pre">Tests</span></span><span class="punctuation"><span class="pre">.</span></span><span class="name"><span class="pre">ini</span></span></code> file. The easiest thing to
do is start from an existing test and modify it. For example, this entry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>MLMG_FI_PoisCom<span class="o">]</span>
<span class="nv">buildDir</span> <span class="o">=</span> Tutorials/LinearSolvers/ABecLaplacian_F
<span class="nv">inputFile</span> <span class="o">=</span> inputs-rt-poisson-com
<span class="nv">dim</span> <span class="o">=</span> <span class="m">3</span>
<span class="nv">restartTest</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">useMPI</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">numprocs</span> <span class="o">=</span> <span class="m">2</span>
<span class="nv">useOMP</span> <span class="o">=</span> <span class="m">1</span>
<span class="nv">numthreads</span> <span class="o">=</span> <span class="m">3</span>
<span class="nv">compileTest</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">doVis</span> <span class="o">=</span> <span class="m">0</span>
<span class="nv">outputFile</span> <span class="o">=</span> plot
<span class="nv">testSrcTree</span> <span class="o">=</span> C_Src
</pre></div>
</div>
<p>defines a test called <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">MLMG_FI_PoisCom</span></span></code> by specifying the appropriate build directory, inputs file,
and a set of configuration options. The above options are the most commonly changed; for a full list
of options, see the example configuration file at <a class="reference external" href="https://github.com/AMReX-Codes/regression_testing/blob/main/example-tests.ini">https://github.com/AMReX-Codes/regression_testing/blob/main/example-tests.ini</a>.</p>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Regression_Testing_Chapter.html" class="btn btn-neutral float-left" title="Regression Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2018, AMReX Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>