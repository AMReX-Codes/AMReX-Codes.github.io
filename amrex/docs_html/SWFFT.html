<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SWFFT &mdash; amrex 21.10-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Regression Testing" href="Regression_Testing_Chapter.html" />
    <link rel="prev" title="SUNDIALS" href="SUNDIALS_top.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> amrex
          </a>
              <div class="version">
                21.10-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">AMReX Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted_Chapter.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="BuildingAMReX_Chapter.html">Building AMReX</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basics_Chapter.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrCore_Chapter.html">AmrCore Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="AmrLevel_Chapter.html">Amr Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkJoin.html">Fork-Join</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO_Chapter.html">I/O (Plotfile, Checkpoint)</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinearSolvers_Chapter.html">Linear Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particle_Chapter.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fortran_Chapter.html">Fortran Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="EB_Chapter.html">Embedded Boundaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPU_Chapter.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visualization_Chapter.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Post_Processing_Chapter.html">Post-Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inputs_Chapter.html">Run-time Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="AMReX_Profiling_Tools_Chapter.html">AMReX-based Profiling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="External_Profiling_Tools_Chapter.html">External Profiling Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="External_Frameworks_Chapter.html">External Frameworks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="SUNDIALS_top.html">SUNDIALS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">SWFFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pencil-redistribution">Pencil Redistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorials">Tutorials</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Regression_Testing_Chapter.html">Regression Testing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="External_Frameworks_Chapter.html">External Frameworks</a> &raquo;</li>
      <li>SWFFT</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/SWFFT.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="swfft">
<span id="swfftdoc"></span><h1>SWFFT<a class="headerlink" href="#swfft" title="Permalink to this headline"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">hacc/SWFFT</span></code>, developed by Adrian Pope et al. at Argonne National Lab, provides the functionality to perform forward and reverse Fast Fourier Transforms (FFT) within a fully parallelized framework built in C++ and F90. In the words of HACC’s developers, SWFFT is a “distributed-memory, pencil-decomposed, parallel 3D FFT.” <a class="footnote-reference brackets" href="#id6" id="id1">1</a> The SWFFT source code is also contained in the following directory within AMReX: <code class="docutils literal notranslate"><span class="pre">amrex/Src/Extern/SWFFT</span></code>. <a class="footnote-reference brackets" href="#id7" id="id2">2</a></p>
<div class="section" id="pencil-redistribution">
<h2>Pencil Redistribution<a class="headerlink" href="#pencil-redistribution" title="Permalink to this headline"></a></h2>
<p>As input, SWFFT takes three-dimensional arrays of data distributed across block-structured grids, and redistributes the data into “pencil” grids in <span class="math notranslate nohighlight">\(z, x,\)</span> and then <span class="math notranslate nohighlight">\(y\)</span>, belonging to different MPI processes. After each pencil conversion, a 1D FFT is performed on the data along the pencil direction using calls to the FFTW <a class="footnote-reference brackets" href="#id8" id="id3">3</a> library. The <code class="docutils literal notranslate"><span class="pre">README</span></code> files in the tutorial directories specify the relationship between the number of grids and the number of MPI processes that should be used. The <code class="docutils literal notranslate"><span class="pre">hacc/SWFFT</span></code> <code class="docutils literal notranslate"><span class="pre">README</span></code> document by Adrian Pope et al. explains restrictions on grid dimensions in relation to the number of MPI processes <a class="footnote-reference brackets" href="#id6" id="id4">1</a>  <a class="footnote-reference brackets" href="#id7" id="id5">2</a>:</p>
<blockquote>
<div><p>[…] A rule of thumb is that [SWFFT] generally works when the number of vertices along
one side of the global 3D grid (“ng”) can be factored into small primes, and
when the number of MPI ranks can also be factored into small primes.
I believe that all of the unique prime factors of the number of MPI ranks
must be present in the set of prime factors of the grid, eg. if you have
20 MPI ranks then ng must be a multiple of 5 and 2. The <code class="docutils literal notranslate"><span class="pre">CheckDecomposition</span></code>
utility is provided to check (on one rank) whether a proposed grid size and
number of MPI ranks will work, which can be done before submitting a large
test with <code class="docutils literal notranslate"><span class="pre">TestDfft/TestFDfft</span></code>.</p>
</div></blockquote>
<p>The relationship between the number of processes versus global grid dimensions is determined by how the total number of grids can be factored from a three dimensional grid structure (block structured grids) into a two dimensional structure (pencil arrays), as shown in the figures below.</p>
<p>The following figures illustrate how data is distributed from block structured grids to pencil arrays within SWFFT, where the colors of each box indicate which MPI rank it belongs to:</p>
<table class="docutils align-center" id="id9">
<caption><span class="caption-number">Table 18 </span><span class="caption-text">SWFFT Redistribution from <span class="math notranslate nohighlight">\(4 \times 4 \times 4\)</span> Box Array into Pencils</span><a class="headerlink" href="#id9" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="_images/grid_4x4x4.png"><img alt="a" src="_images/grid_4x4x4.png" style="width: 100%;" /></a></p></td>
<td><p><a class="reference internal" href="_images/grid_8x8x1.png"><img alt="b" src="_images/grid_8x8x1.png" style="width: 100%;" /></a></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(a) Block structured grids: <span class="math notranslate nohighlight">\(N_x=4,N_y=4,N_z=4\)</span></div>
</div>
</td>
<td><div class="line-block">
<div class="line">(b) Z-pencils: <span class="math notranslate nohighlight">\(N_x=8,N_y=8,N_z=1\)</span></div>
</div>
</td>
</tr>
</tbody>
</table>
<table class="docutils align-center" id="id10">
<caption><span class="caption-number">Table 19 </span><span class="caption-text">SWFFT Redistribution from <span class="math notranslate nohighlight">\(2 \times 2 \times 2\)</span> Box Array into Pencils</span><a class="headerlink" href="#id10" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="_images/grid_2x2x2.png"><img alt="c" src="_images/grid_2x2x2.png" style="width: 100%;" /></a></p></td>
<td><p><a class="reference internal" href="_images/grid_4x2x1.png"><img alt="d" src="_images/grid_4x2x1.png" style="width: 100%;" /></a></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(a) Block structured grids: <span class="math notranslate nohighlight">\(N_x=2,N_y=2,N_z=2\)</span></div>
</div>
</td>
<td><div class="line-block">
<div class="line">(b) Z-pencils: <span class="math notranslate nohighlight">\(N_x=4,N_y=2,N_z=1\)</span></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="_images/grid_1x4x2.png"><img alt="e" src="_images/grid_1x4x2.png" style="width: 100%;" /></a></p></td>
<td><p><a class="reference internal" href="_images/grid_4x1x2.png"><img alt="f" src="_images/grid_4x1x2.png" style="width: 100%;" /></a></p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">(c) X-pencils: <span class="math notranslate nohighlight">\(N_x=1,N_y=4,N_z=2\)</span></div>
</div>
</td>
<td><div class="line-block">
<div class="line">(d) Y-pencils: <span class="math notranslate nohighlight">\(N_x=4,N_y=1,N_z=2\)</span></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Using the same number of AMReX grids as processes has been verified to work in the <a class="reference external" href="https://amrex-codes.github.io/amrex/tutorials_html/SWFFT_Tutorial.html#swfft-poisson">SWFFT Poisson</a> and <a class="reference external" href="https://amrex-codes.github.io/amrex/tutorials_html/SWFFT_Tutorial.html#swfft-simple">SWFFT Simple</a> tutorials. This can be illustrated by the following equation for the total number of grids, <span class="math notranslate nohighlight">\(N_{b}\)</span>, in a regularly structured domain:</p>
<div class="math notranslate nohighlight">
\[N_{b} = m_{bi} m_{bj} = n_{bi} n_{bj} n_{bk},\]</div>
<p>where <span class="math notranslate nohighlight">\(n_{bi}, n_{bj},\)</span> and  <span class="math notranslate nohighlight">\(n_{bk}\)</span> are the number of grids, or boxes, in the <span class="math notranslate nohighlight">\(x, y,\)</span> and <span class="math notranslate nohighlight">\(z\)</span> dimensions of the block-structured grid. Analogously, for pencil distributions, <span class="math notranslate nohighlight">\(m_{bi}\)</span> and <span class="math notranslate nohighlight">\(m_{bj}\)</span> are the number of grids along the remaining dimensions if pencils are taken in the <span class="math notranslate nohighlight">\(k\)</span> direction. There are many possible ways of redistributing the data, for example <span class="math notranslate nohighlight">\(m_{bi} = n_{bi}n_{bk}\)</span> &amp; <span class="math notranslate nohighlight">\(m_{bj} = n_{bj}\)</span> is one possible simple configuration. However, it is evident from the figures above that the SWFFT redistribution algorithm has a more sophisticated method for finding the prime factors of the grid.</p>
</div>
<div class="section" id="tutorials">
<h2>Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this headline"></a></h2>
<p>AMReX contains two SWFFT tutorials, <a class="reference external" href="https://amrex-codes.github.io/amrex/tutorials_html/SWFFT_Tutorial.html#swfft-poisson">SWFFT Poisson</a> and <a class="reference external" href="https://amrex-codes.github.io/amrex/tutorials_html/SWFFT_Tutorial.html#swfft-simple">SWFFT Simple</a>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://amrex-codes.github.io/amrex/tutorials_html/SWFFT_Tutorial.html#swfft-poisson">SWFFT Poisson</a> solves a Poisson equation with periodic boundary conditions.  In it, both a forward FFT
and reverse FFT are called to solve the equation, however, no reordering of the DFT data in k-space is performed.</p></li>
<li><p><a class="reference external" href="https://amrex-codes.github.io/amrex/tutorials_html/SWFFT_Tutorial.html#swfft-simple">SWFFT Simple</a> is useful if the objective is to simply take a forward FFT of data,
and the DFT’s ordering in k-space matters to the user. This tutorial initializes a 3D or 2D <code class="code cpp c++ docutils literal notranslate"><span class="name"><span class="pre">MultiFab</span></span></code>,
takes a forward FFT, and then redistributes the data in k-space back to the “correct,” 0 to <span class="math notranslate nohighlight">\(2\pi\)</span>, ordering.
The results are written to a plot file.</p></li>
</ul>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://xgitlab.cels.anl.gov/hacc/SWFFT">https://xgitlab.cels.anl.gov/hacc/SWFFT</a></p>
</dd>
<dt class="label" id="id7"><span class="brackets">2</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id5">2</a>)</span></dt>
<dd><p>SWFFT source code directory in AMReX: amrex/Src/Extern/SWFFT</p>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p><a class="reference external" href="http://www.fftw.org/">http://www.fftw.org/</a></p>
</dd>
</dl>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="SUNDIALS_top.html" class="btn btn-neutral float-left" title="SUNDIALS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Regression_Testing_Chapter.html" class="btn btn-neutral float-right" title="Regression Testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2018, AMReX Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>