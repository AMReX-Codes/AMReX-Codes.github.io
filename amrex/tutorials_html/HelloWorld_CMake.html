<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HelloWorld with CMake &mdash; amrex 23.09-dev documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            amrex
          </a>
              <div class="version">
                23.09-dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="GuidedTutorials.html">Guided Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="AMR_Tutorial.html">Amr</a></li>
<li class="toctree-l1"><a class="reference internal" href="Basic_Tutorial.html">Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="Blueprint_Tutorial.html">Blueprint</a></li>
<li class="toctree-l1"><a class="reference internal" href="EB_Tutorial.html">EB</a></li>
<li class="toctree-l1"><a class="reference internal" href="ForkJoin_Tutorial.html">Forkjoin</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPU_Tutorial.html">GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="LinearSolvers_Tutorial.html">LinearSolvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ML_Tutorial.html">ML/PYTORCH</a></li>
<li class="toctree-l1"><a class="reference internal" href="MUI_Tutorial.html">MUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles_Tutorial.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python_Tutorial.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDC_Tutorial.html">SDC</a></li>
<li class="toctree-l1"><a class="reference internal" href="SENSEI_Tutorial.html">SENSEI</a></li>
<li class="toctree-l1"><a class="reference internal" href="SUNDIALS_Tutorial.html">SUNDIALS and Time Integrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="SWFFT_Tutorial.html">SWFFT</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">amrex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">HelloWorld with CMake</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/HelloWorld_CMake.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="helloworld-with-cmake">
<span id="guided-helloworld-cmake"></span><h1>HelloWorld with CMake<a class="headerlink" href="#helloworld-with-cmake" title="Permalink to this heading"></a></h1>
<div class="warning admonition">
<p class="admonition-title"><strong>Time to Complete</strong>: 8 mins</p>
<dl class="simple">
<dt><strong>GOALS:</strong></dt><dd><ul class="simple">
<li><p>Compile with CMake</p></li>
<li><p>Learn typical build patterns</p></li>
<li><p>Use flags to enable different capabilities</p></li>
</ul>
</dd>
</dl>
</div>
<p>This tutorial will walk through the steps involved for building the AMReX <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code>
example with CMake. Essential elements of the Git process and the <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> source code
were discussed briefly in <a class="reference internal" href="HelloWorld.html#guided-hello-world"><span class="std std-ref">HelloWorld with GNU Make</span></a> and will not be repeated here.
We will work in the same,
<code class="docutils literal notranslate"><span class="pre">amrex-tutorials/GuidedTutorials/HelloWorld/</span></code> directory.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/amrex-cmake-hello.gif"><img alt="gif showing a CMake build of HelloWorld example." src="_images/amrex-cmake-hello.gif" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-text">Animation showing how to build the HelloWorld example with CMake.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="getting-the-code">
<h2>Getting the Code<a class="headerlink" href="#getting-the-code" title="Permalink to this heading"></a></h2>
<p>When CMake compiles the HelloWorld source code it will look for an AMReX source code directory.
If it does not find one, it will download the development branch of AMReX
from Git and store it in its own files of dependencies. Therefore for this example, we
need only <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> the <code class="docutils literal notranslate"><span class="pre">amrex-tutorials</span></code> repo. To do this, in terminal we type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/AMReX-Codes/amrex-tutorials.git
</pre></div>
</div>
</section>
<section id="compiling-the-code-with-cmake">
<h2>Compiling the Code with CMake<a class="headerlink" href="#compiling-the-code-with-cmake" title="Permalink to this heading"></a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">amrex-tutorials</span></code> directory that we created, navigate to the Guided Tutorials
HelloWorld example at <code class="docutils literal notranslate"><span class="pre">amrex-tutorials/GuidedTutorials/HelloWorld/</span></code>. In the
directory, we should see the file <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. This is the file that
CMake needs to configure and compile the code.</p>
<p>Compiling with CMake requires several steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Create a build directory and enter it.</p></li>
<li><p>Call CMake to configure the HelloWorld project for compilation.</p></li>
<li><p>Compile the code.</p></li>
</ol>
</div></blockquote>
<p>In the terminal, the commands are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..
cmake<span class="w"> </span>--build<span class="w"> </span>.<span class="w"> </span>-j8
</pre></div>
</div>
<p>Using a build directory (aptly named “build” in this example) is done so that our
code is compiled in a directory completely separate from our source code. That way
if we are unhappy with our build parameters or run into other issues, we can simply
delete the entire build directory and start again.</p>
<div class="note admonition">
<p class="admonition-title">A comment on the <code class="docutils literal notranslate"><span class="pre">-j8</span></code> flag:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-j8</span></code> flag tells CMake to compile the code using 8 processes. To compile
with more or less processes, change the value of 8.</p>
</div>
<p>At this point, CMake should have successfully compiled our <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> executable.</p>
</section>
<section id="running-the-helloworld-executable">
<h2>Running the <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> Executable<a class="headerlink" href="#running-the-helloworld-executable" title="Permalink to this heading"></a></h2>
<p>To run the <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> example type,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./HelloWorld
</pre></div>
</div>
<p>The output should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MPI</span> <span class="n">initialized</span> <span class="k">with</span> <span class="mi">1</span> <span class="n">MPI</span> <span class="n">processes</span>
<span class="n">MPI</span> <span class="n">initialized</span> <span class="k">with</span> <span class="n">thread</span> <span class="n">support</span> <span class="n">level</span> <span class="mi">0</span>
<span class="n">AMReX</span> <span class="p">(</span><span class="mf">22.06</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">gff9e832483f1</span><span class="p">)</span> <span class="n">initialized</span>
<span class="n">Hello</span> <span class="n">world</span> <span class="kn">from</span> <span class="nn">AMReX</span> <span class="n">version</span> <span class="mf">22.06</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">gff9e832483f1</span>
<span class="n">AMReX</span> <span class="p">(</span><span class="mf">22.06</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">gff9e832483f1</span><span class="p">)</span> <span class="n">finalized</span>
</pre></div>
</div>
<p>To run with 4 MPI processes, we write:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpiexec<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>./HelloWorld
</pre></div>
</div>
</section>
<section id="compile-configurations-with-cmake">
<h2>Compile Configurations with CMake<a class="headerlink" href="#compile-configurations-with-cmake" title="Permalink to this heading"></a></h2>
<p>Notice that in our example, CMake decided to compile an MPI-enabled
version of our code by default. This default preference is set in
the AMReX CMake source code. If we want to compile a version of
<code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> without MPI, we need to give the commands during
the configuration step. In the following text, we will describe
the steps for doing this.</p>
<p>First, we want to make a new build directory to hold our separate
non-MPI build. Return to the <code class="docutils literal notranslate"><span class="pre">amrex-tutorials/GuidedTutorials/HelloWorld/</span></code>
directory with our source code and
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file. Then create a new build directory and
enter it. I will call the new build directory, “build_nompi”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">build_nompi</span>
<span class="n">cd</span> <span class="n">build_nompi</span>
</pre></div>
</div>
<p>This time when we call <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span></code> we will pass a flag to turn
off MPI. To do this, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">..</span> <span class="o">-</span><span class="n">DAMReX_MPI</span><span class="o">=</span><span class="n">NO</span>
</pre></div>
</div>
<p>With this line, CMake will configure the compilation not to enable MPI.
Now type,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">--</span><span class="n">build</span> <span class="o">.</span> <span class="o">-</span><span class="n">j8</span>
</pre></div>
</div>
<p>to compile the code. After compilation, when we run <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code>
we should get an output like,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AMReX</span> <span class="p">(</span><span class="mf">22.06</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">gff9e832483f1</span><span class="p">)</span> <span class="n">initialized</span>
<span class="n">Hello</span> <span class="n">world</span> <span class="kn">from</span> <span class="nn">AMReX</span> <span class="n">version</span> <span class="mf">22.06</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">gff9e832483f1</span>
<span class="n">AMReX</span> <span class="p">(</span><span class="mf">22.06</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">gff9e832483f1</span><span class="p">)</span> <span class="n">finalized</span>
</pre></div>
</div>
<p>that shows this code was not MPI enabled.</p>
</section>
<section id="cmake-configuration-options">
<h2>CMake Configuration Options<a class="headerlink" href="#cmake-configuration-options" title="Permalink to this heading"></a></h2>
<p>As with GNU Make, there are many compilation options to choose from
when using CMake. For a complete list, see <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/BuildingAMReX.html#customization-options">Customization Options</a> in
the AMReX User’s Guide.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A common mistake when passing flags in CMake is to
forget to use a lower case “e” in the flags. So it should be
“<strong>-DAMReX</strong>” not “-DAMREX”.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2018, AMReX Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>